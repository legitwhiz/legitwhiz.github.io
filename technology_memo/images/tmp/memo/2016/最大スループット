最大スループット

スループットとlatencyとWindow sizeの関係について
ローカルネットワークとの通信のみであれば、そこまで気にする必要はないが、WAN越えの通信となるとlatencyによる影響は、微量であってもスループットへの影響は大きい。
それは、以下の式から証明出来る。

最大スループット=(Window size*8)/(RTT(ms)*1000)

※本来RTTは往復での遅延時間、latencyは片道での遅延時間を指すが、ITでは往復でないと通信が確立出来ないから、RTTはlatencyとITでは、ほぼ同義｡
8をかけているのはbyteをbitに直し、1000をかけているのはミリ秒を秒に直すため｡

デフォルトのwindow size 256KBの場合、RTT2ms以下であれば1Gbps以上となる為、I/Fが1Gbpsなら問題ないが、RTTが5msとなったら最大スループットが400Mbpsとなってしまう。RTTが20msともなると100Mbpsしかスループットが出ない。

RTT20msでI/F速度と同じスループットがWANでも必要な場合のWindow size
┌────┬───┬────┬────┐
│I/F           │ Min     │default   │Max         │
│default   │4K        │ 256K      │4M           │
│1G           │4K        │2M          │8M           │
│10G         │4K        │32M        │64M         │
│40G         │4K        │128M      │256M      │
└────┴───┴────┴────┘

まあ、実際WANにそこまでスループットが必要か判断してから算出するのだが!!

ちなみに簡単出来るからといってpingの応答時間をlatencyと勘違いしないように!!
pingは、送信したパケットサイズと同じサイズで応答するので、pingで64KBのパケットを送った場合、RTTの値は64KBの往復値つまり128KBの時間となります｡
