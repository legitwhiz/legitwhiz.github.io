●サーバの見積もりを出すのに必要な情報ってなんでしょう？

Webオンラインシステムの場合、サービスの性質上、短時間に大量のユーザーがアクセスすることもあります。 こうした状況で、サーバの見積もりを出すのに必要な情報は秒間最大アクセス数だと思います。

今回は秒間最大アクセス数を500と仮定して話を進めたいと思います。

今回扱うサーバの構成
Webサーバ(2core)、Apサーバ(2core)、 DBサーバ(2core)の３つのサーバを扱います。

●それでは現状の把握をしてみよう

アプリケーションのパフォーマンスを測るのにjmeterを使用します。 jmeterはHTTPリクエストを大量に送ることで、大勢のユーザーがアクセスしている状況を作ることができます。

今回は単純なリクエストで使用しますが、シナリオ書いて実行などもできます。他のやり方もありますが、その先の事も考えjmeterの使い方を紹介します。

jmeterの設定
100スレッドで、10秒間に10回送る設定の場合を見ていきます。

1.スレッドグループの追加と設定
テスト計画-> 追加 -> Thread(Users) -> スレッドグループ

2.HTTPリクエストの追加と設定
スレッドグループ -> 追加 -> サンプラー -> HTTPリクエスト
対象のURLに書き換える

3.統計レポートの追加
テスト計画 -> 追加 -> リスナー -> 統計レポート

これで100人が一気にアクセスしてくるのがテストでき、結果の集計も統計レポートがやってくれます。

このサービスがさばくことのできる秒間最大アクセス数は約60程度ということが分かりました。

ーーーーーーーーーーーーーーー
●ここまでで分かったこと

Webサーバ、Apサーバ 、DBサーバを通して、秒間最大60アクセスをさばけるパフォーマンス、ということが分かりました。500アクセスをさばくためには、今の8倍必要です。 
しかし、より詳細な見積もりをするにはそれぞれのサーバのパフォーマンスを見ていく必要があります。

ーーーーーーーーーーーーーーー
●それぞれのサーバのパフォーマンスの見方

dstatコマンドについて

まず、パフォーマンスを測るのに便利なコマンドについて説明します。

dstatのインストール 
$ sudo yum install dstat

およそ全部見れるdstatコマンド 
$ dstat -Tclmdrn --tcp --udp

左から

epoch : 時間
total-cpu-usage : CPUの使用率
load-average : ロードアベレージ
memory-usage : メモリ使用量
dsk/total : ディスクI/O
io/total : I/Oリクエスト数
net/total : ネットワーク
tcp-sockets : TCPコネクション
udp : UDPコネクション
をそれぞれ一望することができます。
